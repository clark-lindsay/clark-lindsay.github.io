<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/site.css">

  </head>

  <body class="font-sans">
    <div id="the-universe">
      <header class="top-0 sticky z-10 w-full bg-white dark:bg-zinc-900 mx-auto p-2 border-b-2 border-zinc-950 dark:border-white">
        <h1 class="text-xl font-semibold">
          <a href="/" class="text-zinc-950 dark:text-white hover:underline">clark lindsay</a>

        </h1>

        <a href="/about" class="text-zinc-950 dark:text-white hover:underline">about</a>

      </header>

      <main class="h-full mx-auto px-2 py-2">
        <div class="container mx-auto px-2"><article class="mx-auto max-w-4xl mb-8 pt-8"><div class="flex items-center justify-between"><h1 class="font-bold text-2xl">Argo: An exploration of the Raft protocol</h1>

<div>2023-11-15</div>
</div>

<hr class="mt-4 mb-8">
<div class="prose dark:prose-invert prose-a:text-purple-500 hover:prose-a:text-purple-700"><p>I (sort of) implemented Raft. If you just want to check that out, it's <a href="https://github.com/clark-lindsay/argo/tree/main">here</a>. What follows is why and how I ended up doing that, and some opinions on how to build understanding.</p>
<h2><a href="#wait-i-know-that-name" aria-hidden="true" class="anchor" id="wait-i-know-that-name"></a>Wait, I know that name</h2>
<p>A few weeks ago I saw a <a href="https://www.youtube.com/watch?v=vYp4LYbnnW8">lecture video</a> pop up in my YouTube recommendations (yes, I'm serious -- I watch a lot of conference talks there) about the <a href="https://raft.github.io/">Raft consensus algorithm</a>. I might have scrolled past it after my experience trying to grok <a href="https://en.wikipedia.org/wiki/Paxos_(computer_science)">Paxos</a>, but I did a double take when I saw that the lecturer was <a href="https://web.stanford.edu/~ouster/cgi-bin/home.php">John Ousterhout</a>, whose book <a href="https://web.stanford.edu/~ouster/cgi-bin/aposd.php">A Philosophy of Software Design</a> was very impactful on my views of, er, software design. I highly recommend it.</p>
<p>So I click into the video and start watching it and I quickly realize that Ousterhout is one of the co-authors of Raft alongside his PhD student <a href="https://ongardie.net/">Diego Ongaro</a>. Not sure how I hadn't made that connection before, but it helps that I had never read the paper. Well, now I'm invested. I had heard of the protocol and had seen enough buzz about it to know that it was <em>neat</em>, but I hadn't looked into it because I tend to build up massive lists of technical topics that I usually prioritize incorrectly. I think I'm getting better at that. I hope, anyway.</p>
<h2><a href="#from-scratch-ish" aria-hidden="true" class="anchor" id="from-scratch-ish"></a>From scratch, ish</h2>
<p>After watching the video and walking away with some rudimentary mental model of the idea(s) in my head I jumped over to their site and read <a href="https://raft.github.io/raft.pdf">the paper itself</a>, and found it very digestible and clear compared to other CS papers I've read. Sure, it has a couple of important details about a practical implementation pretty late into the paper (looking at you, Section 8) but it's all there.</p>
<p>I decided that it would be very instructive, and maybe even a bit fun, to implement the whole thing in my favorite language: <a href="https://elixir-lang.org/">elixir</a>. The <a href="https://www.erlang.org/blog/a-brief-beam-primer/">BEAM</a> has quite the pedigree for building distributed systems, and would supply me with brilliant building blocks for an <em>exploratory</em> implementation of the algorithm.</p>
<p>Before I got going I outlined my goals and some limitations:</p>
<ul>
<li>above all, I'm doing this to grok the algorithm, and to have some fun</li>
<li>I'm okay ignoring distributed nodes, and instead modeling that separation with message passing between BEAM processes</li>
<li>I want to base my implementation solely on the paper, and the lecture video, without referencing one of the many <a href="https://raft.github.io/#implementations">implementations</a> that are open sourced
<ul>
<li>shoutout to the <em><strong>much more complete</strong></em> <a href="https://github.com/elixir-toniq/raft">implementation by my friend Chris Keathley</a></li>
</ul>
</li>
<li>I'm alright not writing the log(s) out to non-volatile storage
<ul>
<li>this defeats the real purpose of the algorithm, but adding it wouldn't hugely increase my understanding of what's going on</li>
</ul>
</li>
</ul>
<h3><a href="#moving-the-bits-around" aria-hidden="true" class="anchor" id="moving-the-bits-around"></a>moving the bits around</h3>
<p>As of this writing, I've spent an average of a few hours (maybe 3?) per day for the last 2 weeks working on this, which was a lot of reading and notebook diagrams followed by short bursts of programming, and I've reached a point of happiness with it. In the back-half of this process I could notice bugs or continue building new pieces without reaching for the paper again, which served as good feedback that I was really &quot;getting it&quot;. Particularly when a subsequent peek at the paper didn't reveal that I had confidently written a new bug, which also happened.</p>
<p><strong>Great</strong> credit is due to the authors of the algorithm for going out of their way to design an understandable algorithm, and for producing excellent reference material.</p>
<p>I named my <em>implementation</em> (rather generous use of the word, frankly) &quot;Argo&quot;, after <a href="https://en.wikipedia.org/wiki/Argo">the ship of Greek myth</a>, and you can check it out <a href="https://github.com/clark-lindsay/argo/tree/main">on github</a>. I figured that the Argo would make an excellent &quot;raft&quot; to sail away from Paxos.</p>
<h2><a href="#well-does-it-work" aria-hidden="true" class="anchor" id="well-does-it-work"></a>Well, does it work?</h2>
<p>For a certain definition of the word &quot;work&quot;, yes! I've cut a number of corners, sure, but I can spin up a local cluster of processes and kill them off at random and they'll elect a new leader, replicate their logs, and keep serving requests as long as a majority of the server processes are still up.</p>
<p>More importantly, I got to dig into the algorithm and get a feel for why each piece of it is there, and how the design choices that the Raft research team made avoided more complicated mechanisms and produced relatively few edge cases. I feel like I really <em>get it</em> now, and I attribute that largely to taking the time to build the thing from scratch (-ish*, since I had brilliant reference material and leaned massively on the BEAM and standard elixir tools).</p>
<h2><a href="#what-ive-learned" aria-hidden="true" class="anchor" id="what-ive-learned"></a>What I've learned</h2>
<p>For one thing: how Raft works. That's the big box: <em>checked</em>. But I also learned, or really <em>re-proved to myself</em>, the value of building understanding from first principles and practice. Writing out and testing the logic for something like Raft's &quot;heartbeats&quot;, even with the aforementioned corner-cutting, is a huge leap in understanding from my first read of the paper, despite the highlighter in my hand that assured me that I signalled the important pieces to my brain.</p>
<p>Got to write some OTP and some property-based testing on the way too, and that's always satisfying.</p>
<p>Now I think I'm moving on to learning more about event streaming and messages queues, Ã  la <a href="https://kafka.apache.org/#:~:text=Apache%20Kafka%20is%20an%20open,%2C%20and%20mission%2Dcritical%20applications.">kafka</a> and <a href="https://www.rabbitmq.com/">RabbitMQ</a>, plus I've got to prep for D&amp;D.</p>
</div>
</article>
</div>


      </main>

    </div>

<footer class="py-4 px-4 border-t-2 border-zinc-950 dark:border-white w-full">
  <div class="container px-2 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 5xl:grid-cols-4 gap-x-16 gap-y-8">
    <div>
      <h4 class="text-lg font-medium mb-2">Links</h4>

      <ul>
        <li>
          <a href="https://github.com/clark-lindsay" class="text-zinc-950 dark:text-white hover:underline">
            github
          </a>

        </li>

      </ul>

    </div>

    <div>
      <h4 class="text-lg font-medium mb-2">Site</h4>

      <ul>
        <li>
          <a href="/feed.xml" class="text-zinc-950 dark:text-white hover:underline">
            RSS
          </a>

        </li>

        <li>
          <a href="https://github.com/clark-lindsay/clark-lindsay.github.io" class="text-zinc-950 dark:text-white hover:underline">
            Source Code
          </a>

        </li>

        <li class="italic text-sm mt-2">
          <span>Built with</span>

          <a class="underline" href="https://github.com/elixir-tools/tableau">Tableau,</a>

          <a class="underline" href="https://tailwindcss.com">TailwindCSS,</a>

        </li>

      </ul>

    </div>

  </div>

</footer>


  </body>


</html>

